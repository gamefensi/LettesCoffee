(()=>{var __webpack_modules__={558:(__unused_webpack_module,exports,__webpack_require__)=>{var passport=__webpack_require__(511),jwt=__webpack_require__(344),dev=!1;exports.COOKIE_OPTIONS={httpOnly:!0,secure:!dev,signed:!0,maxAge:1e3*eval(process.env.REFRESH_TOKEN_EXPIRY),sameSite:"none"},exports.getToken=function(user){return jwt.sign(user,process.env.JWT_SECRET,{expiresIn:eval(process.env.SESSION_EXPIRY)})},exports.getRefreshToken=function(user){var refreshToken=jwt.sign(user,process.env.REFRESH_TOKEN_SECRET,{expiresIn:eval(process.env.REFRESH_TOKEN_EXPIRY)});return refreshToken},exports.verifyUser=passport.authenticate("jwt",{session:!1})},42:(e,r,s)=>{var t=s(185),n=t.Schema,o=s(270),i=new n({refreshToken:{type:String,default:""}}),_=new n({firstName:{type:String,default:""},lastName:{type:String,default:""},authStrategy:{type:String,default:"local"},refreshToken:{type:[i]}});_.set("toJSON",{transform:function(e,r,s){return delete r.refreshToken,r}}),_.plugin(o),e.exports=t.model("User",_)},763:(e,r,s)=>{var t=s(860).Router(),n=s(42),o=s(511),i=s(344),_=s(558),u=_.getToken,a=_.COOKIE_OPTIONS,c=_.getRefreshToken,d=_.verifyUser;s(746).reset,t.post("/signup",(function(e,r,s){var t=e.body,o=t.username,i=t.password,_=t.firstName,d=t.lastName;_?n.register(new n({username:o}),i,(function(e,s){if(e)r.statusCode=500,r.send(e);else{s.firstName=_,s.lastName=d||"";var t=u({_id:s._id}),n=c({_id:s._id});s.refreshToken.push({refreshToken:n}),s.save((function(e,s){e?(r.statusCode=500,r.send(e)):(r.cookie("refreshToken",n,a),r.send({success:!0,token:t}))}))}})):(r.statusCode=500,r.send({name:"FirstNameError",message:"The first name is required"}))})),t.post("/login",o.authenticate("local"),(function(e,r,s){var t=u({_id:e.user._id}),o=c({_id:e.user._id});n.findById(e.user._id).then((function(e){e.refreshToken.push({refreshToken:o}),e.save((function(e,s){e?(r.statusCode=500,r.send(e)):(r.cookie("refreshToken",o,a),r.send({success:!0,token:t}))}))}),(function(e){return s(e)}))})),t.post("/refreshToken",(function(e,r,s){var t=e.signedCookies,o=(void 0===t?{}:t).refreshToken;if(o)try{var _=i.verify(o,process.env.REFRESH_TOKEN_SECRET)._id;n.findOne({_id:_}).then((function(e){if(e){var s=e.refreshToken.findIndex((function(e){return e.refreshToken===o}));if(-1===s)r.statusCode=401,r.send("Unauthorized");else{var t=u({_id:_}),n=c({_id:_});e.refreshToken[s]={refreshToken:n},e.save((function(e,s){e?(r.statusCode=500,r.send(e)):(r.cookie("refreshToken",n,a),r.send({success:!0,token:t}))}))}}else r.statusCode=401,r.send("Unauthorized")}),(function(e){return s(e)}))}catch(e){r.statusCode=401,r.send("Unauthorized")}else r.statusCode=401,r.send("Unauthorized")})),t.get("/me",d,(function(e,r,s){r.send(e.user)})),t.get("/logout",d,(function(e,r,s){var t=e.signedCookies,o=(void 0===t?{}:t).refreshToken;n.findById(e.user._id).then((function(e){var s=e.refreshToken.findIndex((function(e){return e.refreshToken===o}));-1!==s&&e.refreshToken.id(e.refreshToken[s]._id).remove(),e.save((function(e,s){e?(r.statusCode=500,r.send(e)):(r.clearCookie("refreshToken",a),r.send({success:!0}))}))}),(function(e){return s(e)}))})),e.exports=t},639:(e,r,s)=>{var t=s(511),n=s(136).Strategy,o=s(136).ExtractJwt,i=s(42),_={};_.jwtFromRequest=o.fromAuthHeaderAsBearerToken(),_.secretOrKey=process.env.JWT_SECRET,t.use(new n(_,(function(e,r){i.findOne({_id:e._id},(function(e,s){return e?r(e,!1):r(null,s||!1)}))})))},191:(e,r,s)=>{var t=s(511),n=s(55).Strategy,o=s(42);t.use(new n(o.authenticate())),t.serializeUser(o.serializeUser())},183:(e,r,s)=>{var t=s(185),n=process.env.DATABASE;t.connect(n).then((function(e){console.log("connected to db")})).catch((function(e){console.log(e)}))},986:e=>{"use strict";e.exports=require("body-parser")},710:e=>{"use strict";e.exports=require("cookie-parser")},582:e=>{"use strict";e.exports=require("cors")},860:e=>{"use strict";e.exports=require("express")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},185:e=>{"use strict";e.exports=require("mongoose")},746:e=>{"use strict";e.exports=require("nodemon")},511:e=>{"use strict";e.exports=require("passport")},136:e=>{"use strict";e.exports=require("passport-jwt")},55:e=>{"use strict";e.exports=require("passport-local")},270:e=>{"use strict";e.exports=require("passport-local-mongoose")}},__webpack_module_cache__={};function __webpack_require__(e){var r=__webpack_module_cache__[e];if(void 0!==r)return r.exports;var s=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](s,s.exports,__webpack_require__),s.exports}var __webpack_exports__={};(()=>{var e=__webpack_require__(860),r=__webpack_require__(582),s=__webpack_require__(986),t=__webpack_require__(710),n=__webpack_require__(511);__webpack_require__(183),__webpack_require__(639),__webpack_require__(191),__webpack_require__(558);var o=__webpack_require__(763),i=e();i.use(s.json()),i.use(t(process.env.COOKIE_SECRET));var _=process.env.WHITELISTED_DOMAINS?process.env.WHITELISTED_DOMAINS.split(","):[],u={origin:function(e,r){e&&-1===_.indexOf(e)?r(new Error("Not allowed by CORS")):r(null,!0)},credentials:!0};i.use(r(u)),i.use(n.initialize()),i.use("/users",o),i.get("/",(function(e,r){r.send("Hello from Express!")}));var a=i.listen(process.env.PORT||8081,(function(){var e=a.address().address,r=a.address().port;console.log("App listening at http://%s:%s",e,r)}))})()})();